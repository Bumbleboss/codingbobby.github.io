let cvs={width:600,height:600},fr=90,iSlider,horizon={f:{x:0,y:cvs.height/2},t:{x:cvs.width,y:cvs.height/2}},h=horizon,midPoint={x:(h.t.x-h.f.x)/2,y:h.f.y},media={u:{n:1.000293,f:function(){return 100/this.n}},l:{n:1.333,f:function(){return 100/this.n}}},beams={i:{f:{x:0,y:0},t:midPoint},o:{f:midPoint,t:{add:function(){let a=midPoint.x-this.par.i.f.x,c=Math.atan(a/(this.y/2)),d=Math.asin(Math.sin(c)/media.l.n);return Math.tan(d)*this.y/2},x:midPoint.x,y:2*midPoint.y}},init:function(){return this.o.t.par=this,delete this.init,this}}.init(),b=beams;b.o.t.x-=b.o.t.add();function setup(){createCanvas(cvs.width,cvs.height),frameRate(fr),iSlider=createSlider(-cvs.width,2*cvs.width,80),iSlider.position(10,10),iSlider.style('width','80px')}function draw(){b.i.f.x!=iSlider.value()&&(b.o.t.x=midPoint.x,b.o.t.x+=b.o.t.add()),b.i.f.x=iSlider.value(),background(60),fill(60),strokeWeight(3),push(),fill(media.u.f()),noStroke(),rect(0,0,cvs.width,h.f.y),pop(),push(),fill(media.l.f()),noStroke(),rect(0,h.f.y,cvs.width,cvs.height),pop(),push(),stroke(220,60,10),line(b.i.f.x,b.i.f.y,b.i.t.x,b.i.t.y),pop(),push(),stroke(10,200,60),line(b.o.f.x,b.o.f.y,b.o.t.x,b.o.t.y),pop(),push(),stroke(190),line(h.f.x,h.f.y,h.t.x,h.t.y),pop(),push(),strokeWeight(8),stroke(250,220,30),point(midPoint.x,midPoint.y),pop()}
