let cvs={width:600,height:600},fr=90,iSlider,horizon={f:{x:0,y:cvs.height/2},t:{x:cvs.width,y:cvs.height/2}},h=horizon,midPoint={x:(h.t.x-h.f.x)/2,y:h.f.y},midAxis={f:{x:cvs.width/2,y:0},t:{x:cvs.width/2,y:cvs.height}},ma=midAxis,maa={u:{min:1*Math.PI,max:2*Math.PI,mid:3/2*Math.PI},l:{min:0*Math.PI,max:2*Math.PI,mid:1/2*Math.PI}},media={u:{n:1.333,f:function(){return 100/this.n}},l:{n:1.000293,f:function(){return 100/this.n}},a:function(){return Math.asin(this.l.n/this.u.n)}},beams={i:{a:0,t:midPoint,f:function(){let c,e,f,g;return Math.abs(this.a)>rad(45)?(g=rad(90)+this.a,f=Math.tan(g)*midPoint.x,0>this.a?(c=0,e=midPoint.y-f):(c=2*midPoint.x,e=midPoint.y+f)):(g=this.a,f=Math.tan(g)*midPoint.y,c=midPoint.x+f,e=0),{x:c,y:e}}},o:{a:function(){return media.u.n>media.l.n&&Math.abs(this.par.i.a)>media.a()?-this.par.i.a:Math.asin(Math.sin(this.par.i.a)*media.u.n/media.l.n)},f:midPoint,t:function(){let c,e,f,g;switch(media.u.n>media.l.n&&Math.abs(this.par.i.a)>media.a()){case!0:e=this.par.i.f().y,c=this.par.i.f().x>midPoint.x?0:2*midPoint.x;break;case!1:let i=this.a();i>rad(45)?(g=rad(90)+i,f=Math.tan(g)*midPoint.x,c=0>i?2*midPoint.x:0,e=midPoint.y-f):(g=i,f=Math.tan(g)*midPoint.y,c=midPoint.x-f,e=2*midPoint.y);}return{x:c,y:e}}},init:function(){return this.o.par=this,delete this.init,this}}.init(),b=beams;function rad(c){return 2*c*Math.PI/360}function grd(c){return 360*c/(2*Math.PI)}function angleFromX(c,e){return e?rad(270)+c:rad(90)+c}let btn={switch:{text:'SWITCH',x:5,y:25,height:20,width:49}};function mousePressed(){let c=mouseX,e=mouseY;if(onButton(btn.switch,c,e)){let f=media.u.n;media.u.n=media.l.n,media.l.n=f}}function onButton(c,e,f){return e>c.x&&e<c.width+c.x&&f>c.y&&f<c.height+c.y}function setup(){createCanvas(cvs.width,cvs.height),frameRate(fr),iSlider=createSlider(-85,85,0),iSlider.position(10,10),iSlider.style('width','80px')}function draw(){b.i.a!=rad(iSlider.value())&&(b.i.a=rad(iSlider.value())),background(60),fill(60),strokeWeight(3),push(),fill(media.u.f()),noStroke(),rect(0,0,cvs.width,h.f.y),pop(),push(),fill(media.l.f()),noStroke(),rect(0,h.f.y,cvs.width,cvs.height),pop(),push(),fill(120),noStroke(),rect(btn.switch.x,btn.switch.y,btn.switch.width,btn.switch.height),textStart=btn.switch.height+40,fill(240),textSize(10),text(btn.switch.text,btn.switch.x+5,textStart-21),pop(),push(),stroke(240,80,30),strokeWeight(1.5),noFill();let c=angleFromX(b.i.a,!0),e,f;maa.u.mid<c?(e=maa.u.mid,f=c):(e=c,f=maa.u.mid),arc(midPoint.x,midPoint.y,200,200,e,f),pop(),push(),stroke(30,240,80),strokeWeight(1.5),noFill();let g=angleFromX(b.o.a(),!1),i,j;media.u.n>media.l.n&&Math.abs(b.i.a)>media.a()?0<b.i.a?(i=angleFromX(b.o.a(),!0),j=maa.u.mid):(i=maa.u.mid,j=angleFromX(b.o.a(),!0)):maa.l.mid<g?(i=maa.l.mid,j=g):(i=g,j=maa.l.mid),arc(midPoint.x,midPoint.y,200,200,i,j),pop(),push(),stroke(190),line(h.f.x,h.f.y,h.t.x,h.t.y),pop(),push(),stroke(190),strokeWeight(1.5),line(ma.f.x,ma.f.y,ma.t.x,ma.t.y),pop(),push(),stroke(220,60,10),line(b.i.f().x,b.i.f().y,b.i.t.x,b.i.t.y),pop(),push(),stroke(10,200,60),line(b.o.f.x,b.o.f.y,b.o.t().x,b.o.t().y),pop(),push(),strokeWeight(8),stroke(250,220,30),point(midPoint.x,midPoint.y),pop()}
