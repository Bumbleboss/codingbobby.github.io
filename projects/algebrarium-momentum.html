<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/p5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/addons/p5.dom.min.js"></script>

<script type="text/javascript">
/*
AUTHOR: CodingBobby
DATE: 30/11/2018
VERSION: 2.4
PROJECT: algebrarium/conservation of momentum
*/
let t=0,fr=90,v=fr/10,v1=0,v2=0,vd=0,running=!1,touched=!1,cvs={height:600,width:600},btn={start:{text:()=>{return running?'PAUSE':'  PLAY'},x:5,y:5,height:20,width:42},reset:{text:'RESET',x:52,y:5,height:20,width:42}},speedPoints={a:[],b:[]},spheres={a:{},b:{},move:function(){if(this.b.x<this.a.x+this.a.r+this.b.r&&(touched=!0),!touched)return this.a.x+=v1,this.b.x-=v2,{va:v1,vb:v2};let d,e,a=this.a.r,c=this.b.r;return d=(a*v1+c*(-2*v2-v1))/(a+c),e=(-c*v2+a*(2*v1+v2))/(a+c),this.a.x+=d,this.b.x+=e,{va:d,vb:-e}}},drawing=!0,textStart=20,inputWidth=23,sidebar={width:100,height:95},aSlider,bSlider,vSlider;function setup(){createCanvas(2*cvs.width,cvs.height),textSize(50),frameRate(fr),aSlider=createSlider(5,300,80),aSlider.position(10,2*textStart),aSlider.style('width','80px'),bSlider=createSlider(5,300,10),bSlider.position(10,3*textStart),bSlider.style('width','80px'),vSlider=createSlider(0,100,50),vSlider.position(10,4*textStart),vSlider.style('width','80px')}function draw(){0==t&&(spheres.a.r=aSlider.value(),spheres.a.x=1*cvs.width/4-spheres.a.r,spheres.a.y=cvs.height/2,spheres.b.r=bSlider.value(),spheres.b.x=3*cvs.width/4+spheres.b.r,spheres.b.y=cvs.height/2,v1=v*vSlider.value()/100,v2=v*(1-vSlider.value()/100)),background(60),fill(60),strokeWeight(3),push(),fill(40),noStroke(),rect(0,0,sidebar.width,sidebar.height),pop(),push(),fill(120),noStroke(),rect(btn.start.x,btn.start.y,btn.start.width,btn.start.height),textStart=btn.start.height+20,fill(240),textSize(10),text(btn.start.text(),btn.start.x+5,textStart-21),fill(30,240,80),text(aSlider.value(),aSlider.x+aSlider.width+20,aSlider.y),text(bSlider.value(),bSlider.x+bSlider.width+20,bSlider.y),text(vSlider.value()/100,vSlider.x+vSlider.width+20,vSlider.y),pop(),push(),fill(120),noStroke(),rect(btn.reset.x,btn.reset.y,btn.reset.width,btn.reset.height),textStart=btn.reset.height+20,fill(240),textSize(10),text(btn.reset.text,btn.reset.x+5,textStart-21),pop();let a=!!(spheres.a.x&&spheres.a.y),c=!!(spheres.b.x&&spheres.b.y);for(var d in a&&c&&(push(),stroke(240,80,30),noFill(),ellipse(spheres.a.x,spheres.a.y,2*spheres.a.r),pop(),push(),stroke(30,240,80),noFill(),ellipse(spheres.b.x,spheres.b.y,2*spheres.b.r),pop(),running&&(t++,vd=spheres.move(),1<t&&(speedPoints.a.push({x:5*t+cvs.width+30,y:cvs.height/2-15*vd.va}),speedPoints.b.push({x:5*t+cvs.width+32.5,y:cvs.height/2+15*vd.vb})))),push(),noStroke(),rect(cvs.width,0,2*cvs.width,cvs.height),pop(),push(),stroke(190),strokeWeight(3),line(cvs.width,0,cvs.width,cvs.height),strokeWeight(1.5),line(cvs.width+30,30,cvs.width+30,cvs.height-30),line(cvs.width+30,cvs.height/2,2*cvs.width-30,cvs.height/2),beginShape(),vertex(cvs.width+25,45),vertex(cvs.width+30,30),vertex(cvs.width+35,45),endShape(CLOSE),pop(),push(),stroke(240,80,30),speedPoints.a)point(speedPoints.a[d].x,speedPoints.a[d].y);for(var d in pop(),push(),stroke(30,240,80),speedPoints.b)point(speedPoints.b[d].x,speedPoints.b[d].y);pop(),push(),noStroke(),rect(2*cvs.width-45,0,2*cvs.width,cvs.height),pop(),push(),stroke(190),strokeWeight(1.5),beginShape(),vertex(2*cvs.width-45,cvs.height/2-5),vertex(2*cvs.width-30,cvs.height/2),vertex(2*cvs.width-45,cvs.height/2+5),endShape(CLOSE),pop(),push(),noStroke(),fill(30,240,80),textSize(12),text('velocity',cvs.width+40,40),text('time',2*cvs.width-50,cvs.height/2-15),pop()}function mousePressed(){let a=mouseX,c=mouseY;onButton(btn.start,a,c)?running?running=!1:running=!0:onButton(btn.reset,a,c)&&(t=0,speedPoints={a:[],b:[]},running=!1,touched=!1)}function onButton(a,c,d){return c>a.x&&c<a.width+a.x&&d>a.y&&d<a.height+a.y}
</script>
