<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/p5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/addons/p5.dom.min.js"></script>

<script type="text/javascript">
/*
AUTHOR: CodingBobby
DATE: 15/11/2018
VERSION: 2.4
PROJECT: algebrarium/pendulum speed
*/
let cvs={width:420,height:600},fr=60,iSlider,mSlider,lSlider,running=!1,t=0,g=9.81/10,xx,yy,ankerPoint={y:cvs.height/5,x:cvs.width/2},midAxis={f:{x:cvs.width/2,y:0},t:{x:cvs.width/2,y:cvs.height}},ma=midAxis;function rad(c){return 2*c*Math.PI/360}function grd(c){return 360*c/(2*Math.PI)}function angleFromX(c,d){return d?rad(270)+c:rad(90)+c}let btn={start:{text:()=>{return running?'PAUSE':'  PLAY'},x:5,y:28,height:20,width:42},reset:{text:'RESET',x:52,y:28,height:20,width:42}},pendulum={l:300,m:100,a:{init:0,now:0},h:function(c){return this.l*(1-Math.cos(c))},x:function(){return ankerPoint.x+this.l*Math.sin(this.a.now)},y:function(){return ankerPoint.y+this.l*Math.cos(this.a.now)},move:function(){this.a.now=this.a.init*Math.sin(Math.sqrt(g/this.l)*t)}},pn=pendulum,wayPoints=[],speedPoints=[];function mousePressed(){let c=mouseX,d=mouseY;onButton(btn.start,c,d)?running?running=!1:running=!0:onButton(btn.reset,c,d)&&(t=0,wayPoints=[],speedPoints=[],running=!1,pn.a.init=iSlider.value())}function onButton(c,d,f){return d>c.x&&d<c.width+c.x&&f>c.y&&f<c.height+c.y}function setup(){createCanvas(2*cvs.width,cvs.height),frameRate(fr),iSlider=createSlider(-30,30,10),iSlider.position(10,10),iSlider.style('width','200px'),mSlider=createSlider(20,200,50),mSlider.position(10,cvs.height-30),mSlider.style('width','200px'),lSlider=createSlider(60,350,250),lSlider.position(10,cvs.height-10),lSlider.style('width','200px')}function draw(){for(var c in pn.a.init!=rad(iSlider.value())&&(pn.a.init=rad(iSlider.value()),pn.a.now=pn.a.init),pn.m!=mSlider.value()&&(pn.m=mSlider.value()),pn.l!=lSlider.value()&&(pn.l=lSlider.value()),background(60),fill(60),strokeWeight(3),push(),stroke(30,240,80),speedPoints)point(speedPoints[c].x,speedPoints[c].y);pop(),push(),stroke(30,240,80),strokeWeight(1.5),noFill();let d,f;if(0<pn.a.now?(d=angleFromX(-pn.a.now,!1),f=Math.PI/2):(d=Math.PI/2,f=angleFromX(-pn.a.now,!1)),arc(ankerPoint.x,ankerPoint.y,pn.l,pn.l,d,f),pop(),push(),stroke(190),strokeWeight(3),line(cvs.width,0,cvs.width,cvs.height),strokeWeight(1.5),line(ma.f.x,ma.f.y,ma.t.x,ma.t.y),line(1.5*cvs.width,30,1.5*cvs.width,cvs.height-30),line(cvs.width+30,cvs.height/2,2*cvs.width-30,cvs.height/2),beginShape(),vertex(1.5*cvs.width-5,45),vertex(1.5*cvs.width,30),vertex(1.5*cvs.width+5,45),endShape(CLOSE),beginShape(),vertex(2*cvs.width-45,cvs.height/2-5),vertex(2*cvs.width-30,cvs.height/2),vertex(2*cvs.width-45,cvs.height/2+5),endShape(CLOSE),pop(),push(),fill(30,240,80),noStroke(),text(iSlider.value()+'\xB0',215,15),text(mSlider.value()+'g',215,cvs.height-25),text(lSlider.value()/100+'m',215,cvs.height-5),text('velocity',1.5*cvs.width+10,40),text('time',2*cvs.width-50,cvs.height/2+20),pop(),'function'==typeof pn.x||'function'==typeof pn.y?(xx=pn.x(),yy=pn.y()):(xx=pn.x,yy=pn.y),push(),stroke(240,80,30),line(ankerPoint.x,ankerPoint.y,xx,yy),pop(),push(),strokeWeight(8),stroke(250,220,30),point(ankerPoint.x,ankerPoint.y),pop(),push(),stroke(240,80,30),fill(60),ellipse(xx,yy,pn.m/2,pn.m/2),pop(),running){t++,pn.move(),wayPoints.push({x:pn.x(),y:pn.y()});let h=220;1<t&&(speedPoints.push({x:t+cvs.width+30-Math.floor(t/(cvs.width-75))*(cvs.width-75),y:20*(wayPoints[t-2].x-wayPoints[t-1].x)+cvs.height/2}),t>h&&speedPoints.splice(0,speedPoints.length-h))}push(),fill(120),noStroke(),rect(btn.start.x,btn.start.y,btn.start.width,btn.start.height),textStart=btn.start.height+43,fill(240),textSize(10),text(btn.start.text(),btn.start.x+5,textStart-21),pop(),push(),fill(120),noStroke(),rect(btn.reset.x,btn.reset.y,btn.reset.width,btn.reset.height),textStart=btn.reset.height+43,fill(240),textSize(10),text(btn.reset.text,btn.reset.x+5,textStart-21),pop()}
</script>
