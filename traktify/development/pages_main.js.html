<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>pages/main.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/CodingBobby/traktify/issues" target="_blank" class="menu-item" id="issues_link" >Bugs & Issues</a></h2><h2><a href="https://circleci.com/gh/CodingBobby/traktify" target="_blank" class="menu-item" id="build_link" >Build Log</a></h2><h2><a href="https://discord.gg/BJNAMcj" target="_blank" class="menu-item" id="discord_link" >Discord Server</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-cache_.html">Cache</a></li><li><a href="tutorial-config.html">Configuration</a></li><li><a href="tutorial-contributing.html">Contributing</a></li><li><a href="tutorial-helpers.html">Helpers</a></li><li><a href="tutorial-items.html">Items</a></li></ul><h3>Classes</h3><ul><li><a href="Cache.html">Cache</a><ul class='methods'><li data-type='method'><a href="Cache.html#getKey">getKey</a></li><li data-type='method'><a href="Cache.html#remove">remove</a></li><li data-type='method'><a href="Cache.html#removeKey">removeKey</a></li><li data-type='method'><a href="Cache.html#save">save</a></li><li data-type='method'><a href="Cache.html#setKey">setKey</a></li></ul></li><li><a href="Queue.html">Queue</a><ul class='methods'><li data-type='method'><a href="Queue.html#_duplicates">_duplicates</a></li></ul></li><li><a href="showBuffer.html">showBuffer</a></li></ul><h3>Namespaces</h3><ul><li><a href="generators.html">generators</a><ul class='methods'><li data-type='method'><a href="generators.html#.infoCardContent">infoCardContent</a></li><li data-type='method'><a href="generators.html#.infoCardDummy">infoCardDummy</a></li><li data-type='method'><a href="generators.html#.searchResult">searchResult</a></li><li data-type='method'><a href="generators.html#.upNextPoster">upNextPoster</a></li><li data-type='method'><a href="generators.html#.upNextTitle">upNextTitle</a></li></ul></li><li><a href="helper.html">helper</a><ul class='methods'><li data-type='method'><a href="helper.html#.clone">clone</a></li><li data-type='method'><a href="helper.html#.debugLog">debugLog</a></li><li data-type='method'><a href="helper.html#.inRange">inRange</a></li><li data-type='method'><a href="helper.html#.nthParent">nthParent</a></li><li data-type='method'><a href="helper.html#.shadeHexColor">shadeHexColor</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#actionBtns">actionBtns</a></li><li><a href="global.html#addHistoryUpdates">addHistoryUpdates</a></li><li><a href="global.html#APP_PATH">APP_PATH</a></li><li><a href="global.html#cacheListener">cacheListener</a></li><li><a href="global.html#cacheRequest">cacheRequest</a></li><li><a href="global.html#cacheSave">cacheSave</a></li><li><a href="global.html#getAPIKeys">getAPIKeys</a></li><li><a href="global.html#getUnfinishedProgressList">getUnfinishedProgressList</a></li><li><a href="global.html#initFileStructure">initFileStructure</a></li><li><a href="global.html#newActivitiesAvailable">newActivitiesAvailable</a></li><li><a href="global.html#openInfoCard">openInfoCard</a></li><li><a href="global.html#PATHS">PATHS</a></li><li><a href="global.html#postHistoryUpdates">postHistoryUpdates</a></li><li><a href="global.html#readConfig">readConfig</a></li><li><a href="global.html#removeCacheFiles">removeCacheFiles</a></li><li><a href="global.html#requestAndLoadImage">requestAndLoadImage</a></li><li><a href="global.html#requestHistoryUpdatePosting">requestHistoryUpdatePosting</a></li><li><a href="global.html#resetConfig">resetConfig</a></li><li><a href="global.html#saveConfig">saveConfig</a></li><li><a href="global.html#show">show</a></li><li><a href="global.html#showAlertBoxAndWait">showAlertBoxAndWait</a></li><li><a href="global.html#startsWithFilter">startsWithFilter</a></li><li><a href="global.html#toggleClass">toggleClass</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">pages/main.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>if(!remote.getGlobal('darwin')) {
  let dragger = document.getElementById('dragger')
  if(dragger !== null) {
    dragger.remove()
  }
}


//:::: GLOBAL FUNCTIONS ::::\\

function signout() {
  remote.getGlobal('disconnect')()
}

function openDonate() {
  remote.getGlobal('openExternal')('https://buymeacoff.ee/CodingBobby')
}

// TODO: Reloading should only fetch latest changes without reloading the html
function reload() {
  remote.getGlobal('loadDashboard')()
}

function debugLog(...args) {
  remote.getGlobal('debugLog').apply(null, args)
}


//:::: HELPERS ::::\\

// inserts an element before another one
function insertBefore(element, reference) {
  reference.parentNode.insertBefore(element, reference)
}

// adds multiple css styles to an element, example:
// styles: { display: 'block', backgroundColor: 'red' }
function css(element, styles) {
  for(let property in styles) {
    // just a security check
    if({}.hasOwnProperty.call(styles, property)) {
      element.style[property] = styles[property]
    }
  }
}

// returns a random item from a given array
function pick(array) {
  return array[Math.floor(Math.random() * array.length)]
}

// works as Array.prototype.length
function getObjectLength(obj) {
  let len = 0
  for(let item in obj) {
    if(obj.hasOwnProperty(item)) {
      len++
    }
  }
  return len
}

// returns array of object's key-value pairs
function objectToArray(obj) {
  let arr = []
  for(let item in obj) {
    arr.push({
      name: item,
      content: obj[item]
    })
  }
  return arr
}

// This handy function allows to delay recursive actions. The taken arguments are explained below
function delayFunction(
  callback, // function that contains whatever you want, takes an index and an optional array
  delay, // the time to wait between iterations in ms
  itemCount, // the maximum count
  arrayToPass=[], // optional array you want to process
  terminateAtIndex=itemCount, // optional index after which the callback is not delayed anymore, can be used when having many out-of-view items where the delay would stack up otherwise
  current=0 // current iteration index, only used by the function itself
) {
  if(itemCount-current > 0) {
    callback(current, arrayToPass)
    if(current >= terminateAtIndex) {
      debugLog('delay', 'terminated')
      delay = 0
    }
    setTimeout(() => {
      delayFunction(callback, delay, itemCount, arrayToPass, terminateAtIndex, current+1)
    }, delay)
  }
}

function loadImage(parent, src, loadingSrc) {
  let loading_img = document.createElement('img')
  loading_img.src = '../../assets/'+loadingSrc

  parent.appendChild(loading_img)

  let img = document.createElement('img')
  img.src = src

  img.onload = function() {
    setTimeout(() => {
      parent.removeChild(loading_img)
      parent.appendChild(img)
    }, 7*33.3) // some extra animation and framerate buffer
  }
}

/**
 * This function can be called whenever you want to place an image element into some HTML context. It first shows a loading animation but as soon as the requested image is ready, it will take the placeholder's place.
 * @param {object} options 
 * @param {HTMLElement} options.parent dom element the image should be appended to
 * @param {'poster'} options.use in what type of element the image will be used
 * @param {'season'} options.type type the item belongs to
 * @param {number} options.itemId tvdb id of the item
 * @param {any} options.reference some reference we can use
 * @param {object} options.attributes additional attributes, only the final image should get
 * @param {string[]} options.classes CSS classes the final image should have
 * @param {Function} onLoad callback to execute after loading is fully complete
 */
async function requestAndLoadImage(options, onLoad) {
  // placeholder element
  let loading_img = document.createElement('img')
  // the actual image, the placeholder will be updated to
  let img = document.createElement('img')

  switch(options.use) {
    case 'poster': {
      loading_img.src = '../../assets/loading_placeholder.gif'
      options.parent.appendChild(loading_img)

      switch(options.type) {
        case 'season': {
          img.src = await getSeasonPoster(options.itemId, options.reference)
          break
        }
      }
      break
    }
  }

  // adding properties to the final image
  if(options.classes) img.classList = options.classes.join(' ')

  for(let name in options.attributes) {
    if(options.attributes.hasOwnProperty(name)) {
      img.setAttribute(name, options.attributes[name])
    }
  }

  // after desired image is preloaded whilst remaining invisible
  img.onload = function() {
    options.parent.appendChild(img)
    options.parent.removeChild(loading_img)
    
    setTimeout(() => {
      // ensures that the callback is definitely fired after the images are visible
      onLoad()
    }, 250)
  }

  img.onerror = function(event) {
    // event does not contain error codes wtf
    debugLog('error', `loading image from ${img.src}`)

    img.src = '../../assets/'+config.client.placeholder.poster

    options.parent.appendChild(img)
    options.parent.removeChild(loading_img)

    setTimeout(() => {
      onLoad()
    }, 250)
  }
}


/**
 * Highlights the passed element.
 * It does this by giving the element the 'selected' class and removing it from all siblings.
 * @param {HTMLElement} child 
 */
function show(child) {
  let par = child.parentElement.parentElement;
  [...par.children].forEach(element => {
    if(element.children[0] === child) {
      child.classList.add('selected')
    } else {
      element.children[0].classList.remove('selected')
    }
  })
}

/**
 * Adds class to element if it doesn't have it already, otherwise removes it.
 * @param {HTMLElement} child Target element
 */
function toggleClass(child, cssClass) {
  if(child.classList.contains(cssClass)) {
    child.classList.remove(cssClass)
  } else {
    child.classList.add(cssClass)
  }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated with <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a>.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
